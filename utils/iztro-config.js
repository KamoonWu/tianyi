/**
 * iztro配置文件
 * 用于初始化和配置iztro库
 */

// 引入iztro库
let iztro = null;
try {
  iztro = require('iztro');
  console.log('成功从npm加载iztro库');
} catch (error) {
  console.warn('从npm加载iztro库失败，尝试从本地加载');
  try {
    iztro = require('./lib/iztro.min.js');
    console.log('成功从本地加载iztro库');
  } catch (localError) {
    console.error('本地加载iztro库失败:', localError);
  }
}

/**
 * 初始化iztro库
 * @returns {Object} iztro库实例
 */
function initIztro() {
  if (!iztro) {
    console.error('iztro库未成功加载，无法初始化');
    return null;
  }
  
  try {
    // 检查 iztro.config 是否存在
    if (!iztro.config) {
      console.warn('iztro.config 未定义，可能是版本兼容性问题');
      return iztro;
    }
    
    // 配置iztro库
    iztro.config.set({
      // 设置星耀亮度
      brightness: {
        紫微: { 寅: '庙', 午: '庙', 戌: '庙', 申: '陷', 子: '陷', 辰: '陷' },
        天机: { 子: '庙', 申: '庙', 辰: '庙', 午: '陷', 寅: '陷', 戌: '陷' },
        太阳: { 酉: '庙', 亥: '庙', 丑: '庙', 卯: '陷', 巳: '陷', 未: '陷' },
        武曲: { 申: '庙', 子: '庙', 辰: '庙', 寅: '陷', 午: '陷', 戌: '陷' },
        天同: { 卯: '庙', 巳: '庙', 未: '庙', 酉: '陷', 亥: '陷', 丑: '陷' },
        廉贞: { 午: '庙', 寅: '庙', 戌: '庙', 申: '陷', 子: '陷', 辰: '陷' },
        天府: { 亥: '庙', 卯: '庙', 未: '庙', 巳: '陷', 酉: '陷', 丑: '陷' },
        太阴: { 酉: '庙', 亥: '庙', 丑: '庙', 卯: '陷', 巳: '陷', 未: '陷' },
        贪狼: { 寅: '庙', 午: '庙', 戌: '庙', 申: '陷', 子: '陷', 辰: '陷' },
        巨门: { 申: '庙', 子: '庙', 辰: '庙', 寅: '陷', 午: '陷', 戌: '陷' },
        天相: { 未: '庙', 亥: '庙', 卯: '庙', 巳: '陷', 酉: '陷', 丑: '陷' },
        天梁: { 午: '庙', 寅: '庙', 戌: '庙', 申: '陷', 子: '陷', 辰: '陷' },
        七杀: { 巳: '庙', 酉: '庙', 丑: '庙', 亥: '陷', 卯: '陷', 未: '陷' },
        破军: { 午: '庙', 寅: '庙', 戌: '庙', 申: '陷', 子: '陷', 辰: '陷' }
      },
      // 设置四化
      mutagen: {
        甲: { 禄: '廉贞', 权: '破军', 科: '武曲', 忌: '太阳' },
        乙: { 禄: '天机', 权: '天梁', 科: '紫微', 忌: '太阴' },
        丙: { 禄: '天同', 权: '天机', 科: '文昌', 忌: '廉贞' },
        丁: { 禄: '太阴', 权: '天同', 科: '天机', 忌: '巨门' },
        戊: { 禄: '贪狼', 权: '太阴', 科: '右弼', 忌: '天机' },
        己: { 禄: '武曲', 权: '贪狼', 科: '天梁', 忌: '文曲' },
        庚: { 禄: '太阳', 权: '武曲', 科: '太阴', 忌: '天同' },
        辛: { 禄: '巨门', 权: '太阳', 科: '文曲', 忌: '文昌' },
        壬: { 禄: '天梁', 权: '紫微', 科: '左辅', 忌: '武曲' },
        癸: { 禄: '破军', 权: '巨门', 科: '太阴', 忌: '贪狼' }
      }
    });
    
    console.log('iztro库配置成功');
    return iztro;
  } catch (error) {
    console.error('iztro库配置失败:', error);
    return iztro;
  }
}

/**
 * 获取iztro库实例
 * @returns {Object} iztro库实例
 */
function getIztro() {
  return iztro;
}

// 导出模块
module.exports = {
  initIztro,
  getIztro
};